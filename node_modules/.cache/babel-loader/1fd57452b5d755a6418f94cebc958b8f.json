{"ast":null,"code":"import*as authActionTypes from'./authActionTypes';import axiosOrder from'../../axios-orders';export var authStart=function authStart(){return{type:authActionTypes.AUTH_START};};export var authSuccess=function authSuccess(token,userId,email){return{type:authActionTypes.AUTH_SUCCESS,token:token,userId:userId,email:email};};export var authFail=function authFail(error){return{type:authActionTypes.AUTH_FAIL,error:error};};export var authLogout=function authLogout(){localStorage.removeItem('token');localStorage.removeItem('expirationDate');localStorage.removeItem('email');localStorage.removeItem('userId');return{type:authActionTypes.AUTH_LOGOUT};};var checkAuthTimeout=function checkAuthTimeout(expirationTime){return function(dispatch){setTimeout(function(){dispatch(authLogout());},expirationTime*1000);};};export var authAttempt=function authAttempt(email,password){var confirmPassword=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var isSignup=arguments.length>3?arguments[3]:undefined;return function(dispatch){dispatch(authStart());var authData={email:email,password:password,confirmPassword:confirmPassword};var url='/signup';if(!isSignup){url='/login';authData={password:password,email:email};}axiosOrder.post(url,authData).then(function(response){var decryptedJwtExpirationDate=atob(response.data.token.split('.')[1]);var expirationDate=JSON.parse(decryptedJwtExpirationDate).exp;var expiresIn=3600;localStorage.setItem('token',response.data.token);localStorage.setItem('userId',response.data.userId);localStorage.setItem('email',response.data.email);localStorage.setItem('expirationDate',expirationDate);dispatch(authSuccess(response.data.token,response.data.userId,response.data.email));dispatch(checkAuthTimeout(expiresIn));}).catch(function(error){dispatch(authFail(error.response.data.error));});};};export var checkAuthState=function checkAuthState(){return function(dispatch){var token=localStorage.getItem('token');if(!token){dispatch(authLogout());}else{var expirationDate=new Date(parseInt(localStorage.getItem('expirationDate')));if(expirationDate<=new Date().getTime()/1000){dispatch(authLogout());}else{var userId=localStorage.getItem('userId');var email=localStorage.getItem('email');dispatch(authSuccess(token,userId,email));dispatch(checkAuthTimeout(expirationDate-new Date().getTime()/1000));}}};};","map":{"version":3,"names":["authActionTypes","axiosOrder","authStart","type","AUTH_START","authSuccess","token","userId","email","AUTH_SUCCESS","authFail","error","AUTH_FAIL","authLogout","localStorage","removeItem","AUTH_LOGOUT","checkAuthTimeout","expirationTime","dispatch","setTimeout","authAttempt","password","confirmPassword","isSignup","authData","url","post","then","response","decryptedJwtExpirationDate","atob","data","split","expirationDate","JSON","parse","exp","expiresIn","setItem","catch","checkAuthState","getItem","Date","parseInt","getTime"],"sources":["A:/PORTFÃ“LIO/ProjetoNodeShopComRestAPI/front-end-react/src/store/actions/auth.js"],"sourcesContent":["import * as authActionTypes from './authActionTypes';\r\n\r\nimport axiosOrder from '../../axios-orders';\r\n\r\nexport const authStart = () => {\r\n  return {\r\n    type: authActionTypes.AUTH_START,\r\n  };\r\n};\r\n\r\nexport const authSuccess = (token, userId, email) => {\r\n  return {\r\n    type: authActionTypes.AUTH_SUCCESS,\r\n    token: token,\r\n    userId: userId,\r\n    email: email,\r\n  };\r\n};\r\n\r\nexport const authFail = (error) => {\r\n  return {\r\n    type: authActionTypes.AUTH_FAIL,\r\n    error: error,\r\n  };\r\n};\r\n\r\nexport const authLogout = () => {\r\n  localStorage.removeItem('token');\r\n  localStorage.removeItem('expirationDate');\r\n  localStorage.removeItem('email');\r\n  localStorage.removeItem('userId');\r\n  return {\r\n    type: authActionTypes.AUTH_LOGOUT,\r\n  };\r\n};\r\n\r\nconst checkAuthTimeout = (expirationTime) => {\r\n  return (dispatch) => {\r\n    setTimeout(() => {\r\n      dispatch(authLogout());\r\n    }, expirationTime * 1000);\r\n  };\r\n};\r\n\r\nexport const authAttempt = (\r\n  email,\r\n  password,\r\n  confirmPassword = null,\r\n  isSignup\r\n) => {\r\n  return (dispatch) => {\r\n    dispatch(authStart());\r\n\r\n    let authData = {\r\n      email: email,\r\n      password: password,\r\n      confirmPassword: confirmPassword,\r\n    };\r\n\r\n    let url = '/signup';\r\n\r\n    if (!isSignup) {\r\n      url = '/login';\r\n      authData = {\r\n        password: password,\r\n        email: email,\r\n      };\r\n    }\r\n\r\n    axiosOrder\r\n      .post(url, authData)\r\n      .then((response) => {\r\n        const decryptedJwtExpirationDate = atob(\r\n          response.data.token.split('.')[1]\r\n        );\r\n\r\n        const expirationDate = JSON.parse(decryptedJwtExpirationDate).exp;\r\n\r\n        const expiresIn = 3600;\r\n\r\n        localStorage.setItem('token', response.data.token);\r\n        localStorage.setItem('userId', response.data.userId);\r\n        localStorage.setItem('email', response.data.email);\r\n        localStorage.setItem('expirationDate', expirationDate);\r\n        dispatch(\r\n          authSuccess(\r\n            response.data.token,\r\n            response.data.userId,\r\n            response.data.email\r\n          )\r\n        );\r\n        dispatch(checkAuthTimeout(expiresIn));\r\n      })\r\n      .catch((error) => {\r\n        dispatch(authFail(error.response.data.error));\r\n      });\r\n  };\r\n};\r\n\r\nexport const checkAuthState = () => {\r\n  return (dispatch) => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      dispatch(authLogout());\r\n    } else {\r\n      const expirationDate = new Date(\r\n        parseInt(localStorage.getItem('expirationDate'))\r\n      );\r\n\r\n      if (expirationDate <= new Date().getTime() / 1000) {\r\n        dispatch(authLogout());\r\n      } else {\r\n        const userId = localStorage.getItem('userId');\r\n        const email = localStorage.getItem('email');\r\n        dispatch(authSuccess(token, userId, email));\r\n        dispatch(\r\n          checkAuthTimeout(expirationDate - new Date().getTime() / 1000)\r\n        );\r\n      }\r\n    }\r\n  };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}