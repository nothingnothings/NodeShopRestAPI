{"ast":null,"code":"import * as authActionTypes from './authActionTypes';\nimport axiosOrder from '../../axios-orders';\nexport const authStart = () => {\n  return {\n    type: authActionTypes.AUTH_START\n  };\n};\nexport const authSuccess = (token, userId, email) => {\n  return {\n    type: authActionTypes.AUTH_SUCCESS,\n    token: token,\n    userId: userId,\n    email: email\n  };\n};\nexport const authFail = error => {\n  return {\n    type: authActionTypes.AUTH_FAIL,\n    error: error\n  };\n};\nexport const authLogout = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('expirationDate');\n  localStorage.removeItem('email');\n  localStorage.removeItem('userId');\n  return {\n    type: authActionTypes.AUTH_LOGOUT\n  };\n};\n\nconst checkAuthTimeout = expirationTime => {\n  return dispatch => {\n    setTimeout(() => {\n      dispatch(authLogout());\n    }, expirationTime * 1000);\n  };\n};\n\nexport const authAttempt = function (email, password) {\n  let confirmPassword = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  let isSignup = arguments.length > 3 ? arguments[3] : undefined;\n  return dispatch => {\n    dispatch(authStart());\n    const authData = {\n      email: email,\n      password: password // returnSecureToken: true     ////optional value (FIREBASE)\n\n    };\n    let url = '/signup';\n\n    if (!isSignup) {\n      url = '/login';\n    }\n\n    axiosOrder.post(url, authData).then(response => {\n      const decryptedJwtExpirationDate = atob(response.data.token.split('.')[1]);\n      const expirationDate = JSON.parse(decryptedJwtExpirationDate).exp;\n      const expiresIn = 3600; // const expirationDate = new Date(\n      //   new Date().getTime() + response.data.expiresIn * 1000\n      // );\n\n      localStorage.setItem('token', response.data.token);\n      localStorage.setItem('userId', response.data.userId);\n      localStorage.setItem('email', response.data.email);\n      localStorage.setItem('expirationDate', expirationDate);\n      dispatch(authSuccess(response.data.token, response.data.userId, response.data.email));\n      dispatch(checkAuthTimeout(expiresIn));\n    }).catch(error => {\n      dispatch(authFail(error.response.data.error));\n    });\n  };\n};\nexport const checkAuthState = token => {\n  return dispatch => {\n    if (!token) {\n      dispatch(authLogout());\n    } else {\n      const expirationDate = new Date(parseInt(localStorage.getItem('expirationDate')));\n\n      if (expirationDate <= new Date().getTime() / 1000) {\n        dispatch(authLogout());\n      } else {\n        const userId = localStorage.getItem('userId');\n        const email = localStorage.getItem('email');\n        dispatch(authSuccess(token, userId, email));\n        dispatch(checkAuthTimeout(expirationDate - new Date().getTime() / 1000));\n      }\n    }\n  };\n};","map":{"version":3,"names":["authActionTypes","axiosOrder","authStart","type","AUTH_START","authSuccess","token","userId","email","AUTH_SUCCESS","authFail","error","AUTH_FAIL","authLogout","localStorage","removeItem","AUTH_LOGOUT","checkAuthTimeout","expirationTime","dispatch","setTimeout","authAttempt","password","confirmPassword","isSignup","authData","url","post","then","response","decryptedJwtExpirationDate","atob","data","split","expirationDate","JSON","parse","exp","expiresIn","setItem","catch","checkAuthState","Date","parseInt","getItem","getTime"],"sources":["A:/PORTFÃ“LIO/ProjetoNodeShopComRestAPI/front-end-react/src/store/actions/auth.js"],"sourcesContent":["import * as authActionTypes from './authActionTypes';\r\n\r\nimport axiosOrder from '../../axios-orders';\r\n\r\nexport const authStart = () => {\r\n  return {\r\n    type: authActionTypes.AUTH_START,\r\n  };\r\n};\r\n\r\nexport const authSuccess = (token, userId, email) => {\r\n  return {\r\n    type: authActionTypes.AUTH_SUCCESS,\r\n    token: token,\r\n    userId: userId,\r\n    email: email,\r\n  };\r\n};\r\n\r\nexport const authFail = (error) => {\r\n  return {\r\n    type: authActionTypes.AUTH_FAIL,\r\n    error: error,\r\n  };\r\n};\r\n\r\nexport const authLogout = () => {\r\n  localStorage.removeItem('token');\r\n  localStorage.removeItem('expirationDate');\r\n  localStorage.removeItem('email');\r\n  localStorage.removeItem('userId');\r\n  return {\r\n    type: authActionTypes.AUTH_LOGOUT,\r\n  };\r\n};\r\n\r\nconst checkAuthTimeout = (expirationTime) => {\r\n  return (dispatch) => {\r\n    setTimeout(() => {\r\n      dispatch(authLogout());\r\n    }, expirationTime * 1000);\r\n  };\r\n};\r\n\r\nexport const authAttempt = (\r\n  email,\r\n  password,\r\n  confirmPassword = null,\r\n  isSignup\r\n) => {\r\n  return (dispatch) => {\r\n    dispatch(authStart());\r\n\r\n    const authData = {\r\n      email: email,\r\n      password: password,\r\n      // returnSecureToken: true     ////optional value (FIREBASE)\r\n    };\r\n\r\n    let url = '/signup';\r\n\r\n    if (!isSignup) {\r\n      url = '/login';\r\n    }\r\n\r\n    axiosOrder\r\n      .post(url, authData)\r\n      .then((response) => {\r\n        const decryptedJwtExpirationDate = atob(\r\n          response.data.token.split('.')[1]\r\n        );\r\n\r\n        const expirationDate = JSON.parse(decryptedJwtExpirationDate).exp;\r\n\r\n        const expiresIn = 3600;\r\n\r\n        // const expirationDate = new Date(\r\n        //   new Date().getTime() + response.data.expiresIn * 1000\r\n        // );\r\n        localStorage.setItem('token', response.data.token);\r\n        localStorage.setItem('userId', response.data.userId);\r\n        localStorage.setItem('email', response.data.email);\r\n        localStorage.setItem('expirationDate', expirationDate);\r\n        dispatch(\r\n          authSuccess(\r\n            response.data.token,\r\n            response.data.userId,\r\n            response.data.email\r\n          )\r\n        );\r\n        dispatch(checkAuthTimeout(expiresIn));\r\n      })\r\n      .catch((error) => {\r\n        dispatch(authFail(error.response.data.error));\r\n      });\r\n  };\r\n};\r\n\r\nexport const checkAuthState = (token) => {\r\n  return (dispatch) => {\r\n   \r\n    if (!token) {\r\n      dispatch(authLogout());\r\n    } else {\r\n      const expirationDate = new Date(\r\n        parseInt(localStorage.getItem('expirationDate'))\r\n      );\r\n\r\n      if (expirationDate <= new Date().getTime() / 1000) {\r\n        dispatch(authLogout());\r\n      } else {\r\n        const userId = localStorage.getItem('userId');\r\n        const email = localStorage.getItem('email');\r\n        dispatch(authSuccess(token, userId, email));\r\n        dispatch(\r\n          checkAuthTimeout(expirationDate - new Date().getTime() / 1000)\r\n        );\r\n      }\r\n    }\r\n  };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}